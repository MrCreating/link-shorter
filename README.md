# link-shorter
Небольшое приложение для сокращения ссылок.

# Запуск
1. Создайте базу данных `links` в MySQL
2. Создайте в этой БД таблицу `data` с полями: 
    * `id - BIGINT AUTOINCREMENT PRIMARY KEY`
    * `query - TEXT`
    * `url - TEXT`
3. Отредактируйте файл `config.json`, указав в нём:
    * `domain` - строка, это то, что будет отдаваться в сокращённой ссылке, указывается вместе с протоколом передачи данных и портом (если не 80 и не 443).
    * `port` - число, порт для запуска сервера
    * `host` - строка, адрес для подключения к MySQL
    * `user` - строка, пользователь MySQL
    * `password` - строка, пароль MySQL
    * `ssl_cert` - строка, путь к файлу SSL-сертификата, необязательно
    * `ssl_key` - строка, путь к файлу SSL-ключа, необязательно
4. Запустите файл `index.js` перейдите по вашему домену/IP и указанному порту. Должно открыться окно с предложением сокращения ссылки.

# JSON-API
Для использования JSON-API отправьте `POST` запрос на корневой URL (`/`)
В Form-Data отправьте следующие поля:
1. `action` - `createLink`: Сокращение ссылки
2. `url` - `$url`: Ссылка для сокращения
3. `screen_name` - `$screen_name` - кастомная ссылка (необязательно).

В случае успеха возращается JSON вида:
`{"result": {
      "url": $url
   }
}`.

В случае же ошибки:
`{"error": {
      "code": $code,
      "message": $message
   }
}`.

# Коды ошибок API
* `1` - Ссылка занята (обычно возникает при указании кастомной ссылки)
* `2` - Ссылка слишком длинная. Не более 16 символов (обычно возникает при указании кастомной ссылки)
* `3` - Переданная ссылка некорректа (Она должна быть вида `http://example.com/`)
* `4` - Итоговая ссылка некорректна. Может содержать только латинские буквы и цифры (обычно возникает при указании кастомной ссылки)

# API-функции
* `LinkShorter(config = null, databaseConnection = null, cacheConnection = null)` - конструктор класса `LinkShorter`, принимает параметры:
    * `config` - Объект из config.json (Необязательно, если переданы следующие 2 параметра)
    * `databaseConnection` - Объект текущего подключения к БД (Необязательно, будет открыто новое)
    * `cacheConnection` - Объект подключения к Memcached (Необязательно, подключится самостоятельно)
* `LinkShorter.createLink(neededUrl, readableUrl)` - создаёт QUERY, который нужно присоединить к домену для получения сокращённой ссылки, принимает параметры:
    * `neededUrl` - строка, ссылка, которую нужно сократить
    * `readableUrl` - строка, необязательный параметр, который будет в роли сокращённой ссылки
* `LinkShorter.getLink(query)` - получает оригинальную ссылку по QUERY, принимает параметры
    * `query` - строка, сокращённая ссылка без домена

# Рабочий пример доступен на https://yunnet.ru:7575/
